# Diff: adicionar guard de escola no summary da importação

```diff
*** Update File: apps/web/src/app/api/migracao/[importId]/summary/route.ts
@@
-import { createClient } from "~/lib/supabase/server";
+import { createClient } from "~/lib/supabase/server";
+import { resolveEscolaIdForUser } from "@/lib/tenant/resolveEscolaIdForUser";
+import { importBelongsToEscola } from "../../auth-helpers";
@@
-  const supabase = await createClient();
+  const supabase = await createClient();
+  const { data: userData } = await supabase.auth.getUser();
+  const user = userData?.user;
+
+  if (!user) {
+    return NextResponse.json({ error: "Não autenticado" }, { status: 401 });
+  }
+
+  const escolaId = await resolveEscolaIdForUser(supabase as any, user.id);
+  if (!escolaId) {
+    return NextResponse.json({ error: "Sem vínculo com a escola" }, { status: 403 });
+  }
+
+  const sameEscola = await importBelongsToEscola(supabase as any, importId, escolaId);
+  if (!sameEscola) {
+    return NextResponse.json({ error: "Importação não pertence à escola" }, { status: 403 });
+  }
```
